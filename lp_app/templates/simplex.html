<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Programming Solver</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        select option {
            background-color: #374151;
            color: white;
        }
        .title-gradient {
            background: linear-gradient(to right, #4ade80, #3b82f6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(74, 222, 128, 0.2);
            line-height: 1.2;
        }
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(8px);
            padding: 10px;
            border-radius: 50%;
            border: 1px solid rgba(75, 85, 99, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 50;
        }
        .back-button:hover {
            transform: scale(1.1);
            background: rgba(17, 24, 39, 0.9);
        }
        .back-arrow {
            width: 24px;
            height: 24px;
            fill: #4ade80;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 text-gray-100 min-h-screen overflow-x-hidden flex items-center">
    <!-- Back Button -->
    <a href="/" class="back-button" title="Back to Home">
        <svg class="back-arrow" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
    </a>

    <div class="container mx-auto px-4 py-12 opacity-0 max-w-7xl" id="mainContainer">
        <h1 class="text-5xl font-bold text-center mb-16 title-gradient pt-8">
            Simplex Method Solver
        </h1>
        
        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
            <!-- Input Form -->
            <div class="xl:col-span-6 xl:col-start-4 transform hover:scale-[1.02] transition-transform duration-300">
                <div class="bg-gray-800/30 backdrop-blur-lg rounded-2xl shadow-xl p-8 border border-gray-700/50">
                    <form id="lp-form" class="space-y-6">
                        {% csrf_token %}
                        <div class="form-group opacity-0">
                            <label class="block text-sm font-medium mb-2 text-green-400" for="optimization_type">
                                Optimization Type
                            </label>
                            <select id="optimization_type" name="optimization_type" required
                                class="w-full bg-gray-700 text-white border border-gray-600 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-400 focus:border-transparent transition-colors duration-200">
                                <option value="minimize">Minimize</option>
                                <option value="maximize">Maximize</option>
                            </select>
                        </div>

                        <div class="form-group opacity-0">
                            <label class="block text-sm font-medium mb-2 text-green-400" for="variables">
                                Number of Variables
                            </label>
                            <input type="number" id="variables" name="variables" min="1" value="2"
                                class="w-full bg-gray-700 text-white border border-gray-600 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-400 focus:border-transparent transition-colors duration-200" required>
                        </div>

                        <div class="form-group opacity-0">
                            <label class="block text-sm font-medium mb-2 text-green-400" for="objective">
                                Objective Function
                            </label>
                            <input type="text" id="objective" name="objective" 
                                placeholder="e.g., 2a + 3b + 4c"
                                class="w-full bg-gray-700 text-white border border-gray-600 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-400 focus:border-transparent transition-colors duration-200" required>
                        </div>
                        
                        <div class="form-group opacity-0">
                            <label class="block text-sm font-medium mb-2 text-green-400" for="constraints">
                                Constraints
                            </label>
                            <input type="text" id="constraints" name="constraints"
                                placeholder="e.g., a + 2b + c <= 10; 3a + 4b + 2c <= 15"
                                class="w-full bg-gray-700 text-white border border-gray-600 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-400 focus:border-transparent transition-colors duration-200" required>
                            <p class="mt-2 text-sm text-gray-400">Separate constraints with semicolons (;)</p>
                        </div>

                        <button type="submit" id="solveBtn"
                            class="w-full bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-medium py-3 px-6 rounded-xl transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-2 focus:ring-offset-gray-800 opacity-0 transform hover:scale-[1.02]">
                            Solve
                        </button>
                    </form>
                    <div id="error-message" class="text-red-400 mt-4 px-4 py-3 rounded-lg bg-red-500/10 border border-red-500/50 hidden"></div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="xl:col-span-6 xl:col-start-4">
                <div id="solution-container" class="bg-gray-800/30 backdrop-blur-lg rounded-2xl shadow-xl p-8 border border-gray-700/50 hidden transform hover:scale-[1.02] transition-transform duration-300">
                    <h2 class="text-2xl font-semibold mb-6 text-green-400">Solution</h2>
                    <div class="space-y-4">
                        <div id="solution" class="text-lg"></div>
                        <div id="optimal-value" class="text-lg mt-4"></div>
                        <div id="iterations" class="text-lg mt-4 text-gray-300"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
            // GSAP Animations
            document.addEventListener('DOMContentLoaded', () => {
                gsap.to('#mainContainer', {
                    opacity: 1,
                    duration: 1,
                    ease: 'power2.out'
                });

                gsap.to('.form-group', {
                    opacity: 1,
                    y: 0,
                    stagger: 0.2,
                    duration: 0.8,
                    ease: 'back.out'
                });

                gsap.to('#solveBtn', {
                    opacity: 1,
                    y: 0,
                    duration: 0.8,
                    delay: 0.8,
                    ease: 'back.out'
                });
            });

            // Form submission handler
            const form = document.getElementById('lp-form');
            const errorMessage = document.getElementById('error-message');
            const solutionContainer = document.getElementById('solution-container');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                const submitBtn = this.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="inline-block animate-spin mr-2">â†»</span> Solving...';
                errorMessage.classList.add('hidden');

                try {
                    const formData = {
                        optimization_type: document.getElementById('optimization_type').value,
                        variables: document.getElementById('variables').value,
                        objective: document.getElementById('objective').value,
                        constraints: document.getElementById('constraints').value
                    };

                    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

                    const response = await fetch('/simplex/solve/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken
                        },
                        body: JSON.stringify(formData),
                        credentials: 'same-origin'
                    });

                    if (!response.ok) {
                        const errorData = await response.text();
                        throw new Error(`Server error: ${errorData}`);
                    }

                    const result = await response.json();

                    if (result.error) {
                        throw new Error(result.error);
                    }

                    solutionContainer.classList.remove('hidden');

                    // Handle the solution object instead of array
                    const solutionText = Object.entries(result.solution)
                        .map(([variable, value]) => `${variable} = ${value.toFixed(4)}`)
                        .join(', ');
                        
                    document.getElementById('solution').textContent = `Optimal Solution: ${solutionText}`;
                    document.getElementById('optimal-value').textContent = `Optimal Value: ${result.optimal_value.toFixed(4)}`;
                    document.getElementById('iterations').textContent = `Number of Iterations: ${result.iterations}`;

                    // Smooth scroll to results
                    solutionContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } catch (error) {
                    errorMessage.textContent = error.message;
                    errorMessage.classList.remove('hidden');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Solve';
                }
            });    
        </script>
</body>
</html>